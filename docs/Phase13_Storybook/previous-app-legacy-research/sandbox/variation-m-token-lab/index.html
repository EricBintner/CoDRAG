<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Variation M — Token Lab</title>
  <style>
    :root {
      --bg: #0b0f16;
      --surface: rgba(17, 24, 38, 0.80);
      --surface2: rgba(15, 21, 34, 0.90);
      --text: #eaf0ff;
      --muted: rgba(234, 240, 255, 0.70);
      --border: rgba(255,255,255,0.12);
      --border2: rgba(255,255,255,0.18);
      --accent: #7aa7ff;
      --ok: #6ee7b7;
      --danger: #ff5a7a;
      --space: 14px;
      --radius: 16px;
      --shadow: 0 18px 60px rgba(0,0,0,0.45);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(circle at 18% 10%, color-mix(in oklab, var(--accent) 18%, transparent), transparent 55%),
        radial-gradient(circle at 78% 22%, rgba(110, 231, 183, 0.12), transparent 48%),
        var(--bg);
      color: var(--text);
    }

    a { color: inherit; text-decoration: none; }

    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 28px;
      display: grid;
      gap: 18px;
    }

    .top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 18px;
      flex-wrap: wrap;
    }

    .kicker {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.02em;
    }

    .sub {
      margin: 10px 0 0 0;
      color: var(--muted);
      max-width: 70ch;
      line-height: 1.5;
      font-size: 14px;
    }

    .nav {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      cursor: pointer;
      transition: transform 120ms ease, background 120ms ease;
    }

    .btn:hover { background: rgba(255,255,255,0.10); }
    .btn:active { transform: translateY(1px); }
    .btn:focus { outline: none; box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent) 35%, transparent); }

    .grid {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 1040px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      border: 1px solid var(--border);
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .cardHeader {
      padding: calc(var(--space) + 6px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    .title {
      font-weight: 650;
      letter-spacing: -0.01em;
    }

    .hint {
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    .cardBody {
      padding: var(--space);
      display: grid;
      gap: 12px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .pillRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .pill {
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
      transition: background 120ms ease;
    }

    .pill[aria-pressed="true"] {
      background: color-mix(in oklab, var(--accent) 18%, rgba(255,255,255,0.06));
      border-color: color-mix(in oklab, var(--accent) 45%, var(--border2));
    }

    .slider {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
    }

    .slider input[type="range"] { width: 100%; }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .tokenList {
      display: grid;
      gap: 8px;
    }

    .token {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
    }

    .tokenKey { color: var(--muted); font-size: 12px; }
    .tokenVal { font-size: 12px; }

    .swatch {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 1px solid var(--border2);
      background: var(--accent);
    }

    .preview {
      display: grid;
      gap: 12px;
      padding: var(--space);
    }

    .panel {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface2);
      padding: var(--space);
    }

    .panelTitle {
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .components {
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 12px;
    }

    @media (max-width: 920px) {
      .components { grid-template-columns: 1fr; }
    }

    .field {
      display: grid;
      gap: 8px;
    }

    label { font-size: 12px; color: var(--muted); }

    input[type="text"], textarea {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      outline: none;
    }

    input[type="text"]:focus, textarea:focus {
      box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent) 35%, transparent);
      border-color: color-mix(in oklab, var(--accent) 55%, var(--border2));
    }

    .btnPrimary {
      border-color: color-mix(in oklab, var(--accent) 55%, var(--border2));
      background: color-mix(in oklab, var(--accent) 24%, rgba(255,255,255,0.06));
    }

    .btnDanger {
      border-color: color-mix(in oklab, var(--danger) 55%, var(--border2));
      background: color-mix(in oklab, var(--danger) 18%, rgba(255,255,255,0.06));
    }

    .chip {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
      font-size: 12px;
      color: var(--muted);
    }

    .chipDot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--ok);
    }

    .toast {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: start;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.30);
    }

    .toastIcon {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: color-mix(in oklab, var(--ok) 20%, rgba(255,255,255,0.06));
      display: grid;
      place-items: center;
      color: var(--ok);
      font-weight: 800;
    }

    .toastTitle { font-weight: 650; }
    .toastText { color: var(--muted); font-size: 12px; margin-top: 4px; line-height: 1.4; }

    .footer {
      padding: 18px 28px 28px 28px;
      color: var(--muted);
      font-size: 12px;
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
      border-bottom-color: rgba(255,255,255,0.28);
      padding: 3px 7px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="kicker"><span class="badge">Variation M</span><span class="mono">Token lab</span></div>
        <h1>Design Tokens as a Product Surface</h1>
        <p class="sub">A sandbox exploring semantic tokens, density scaling, and component consistency. This is a "system" UI: it shows how Halley can stay coherent across chat, personas, worlds, and settings by treating tokens as first-class.</p>
      </div>
      <div class="nav">
        <a class="btn" href="../index.html">Back</a>
        <button class="btn btnPrimary" id="export">Export tokens</button>
      </div>
    </div>

    <div class="grid">
      <section class="card" aria-label="Token controls">
        <div class="cardHeader">
          <div>
            <div class="title">Controls</div>
            <div class="hint">Try theme + density. Tokens update the preview and the token list in real time.</div>
          </div>
          <div class="pillRow" role="group" aria-label="Theme">
            <button class="pill" data-theme="calm" aria-pressed="true">Calm dark</button>
            <button class="pill" data-theme="paper" aria-pressed="false">Paper light</button>
            <button class="pill" data-theme="neon" aria-pressed="false">Midnight neon</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="row">
            <div class="slider">
              <div class="mono" style="min-width: 120px; color: var(--muted);">Density</div>
              <input id="density" type="range" min="10" max="18" value="14" />
              <div class="mono" id="densityVal" style="min-width: 44px; text-align: right; color: var(--muted);">14</div>
            </div>
          </div>

          <div class="row">
            <div class="panel">
              <div class="panelTitle">Semantic tokens</div>
              <div class="tokenList mono" id="tokenList"></div>
            </div>
          </div>

          <div class="row">
            <div class="panel">
              <div class="panelTitle">Why this matters</div>
              <div style="color: var(--muted); font-size: 13px; line-height: 1.5;">
                If Halley picks a north-star (e.g., Yale Grid or Enterprise Console), tokens prevent drift.
                Components stay consistent while still allowing theme, density, and accessibility modes.
              </div>
              <div style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px;">
                <span class="chip"><span class="chipDot"></span>Chat readability</span>
                <span class="chip"><span class="chipDot"></span>Persona editing</span>
                <span class="chip"><span class="chipDot"></span>World navigation</span>
                <span class="chip"><span class="chipDot"></span>Memory/audit tools</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="card" aria-label="Preview components">
        <div class="cardHeader">
          <div>
            <div class="title">Component preview</div>
            <div class="hint">Representative elements: command input, CTA, destructive action, and a memory toast.</div>
          </div>
          <div class="pillRow" style="gap: 10px;">
            <span class="kbd">Tab</span>
            <span class="kbd">Shift</span>
            <span class="kbd">Enter</span>
          </div>
        </div>

        <div class="preview">
          <div class="components">
            <div class="panel">
              <div class="panelTitle">Chat composer</div>
              <div class="field">
                <label for="prompt">Prompt</label>
                <textarea id="prompt" rows="4" placeholder="Describe the world state you want. e.g. 'Tonight's scene is quiet, rain on glass, low stakes.'"></textarea>
              </div>
              <div style="display:flex; gap: 10px; flex-wrap: wrap; margin-top: 12px;">
                <button class="btn btnPrimary">Send</button>
                <button class="btn">Save draft</button>
                <button class="btn btnDanger">Clear</button>
              </div>
              <div style="margin-top: 12px; color: var(--muted); font-size: 12px; line-height: 1.4;">
                Suggestion: Map actions to semantic intent (primary / secondary / destructive) so the system stays consistent across themes.
              </div>
            </div>

            <div class="panel">
              <div class="panelTitle">World + Persona</div>
              <div class="field">
                <label for="world">World</label>
                <input id="world" type="text" value="Halley — Rain City" />
              </div>
              <div class="field" style="margin-top: 10px;">
                <label for="persona">Persona</label>
                <input id="persona" type="text" value="CLaRa (reflective, honest)" />
              </div>
              <div style="margin-top: 12px; display:flex; gap: 8px; flex-wrap: wrap;">
                <span class="chip"><span class="chipDot" style="background: var(--accent);"></span>SFW: on</span>
                <span class="chip"><span class="chipDot" style="background: var(--ok);"></span>Memory: capture</span>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="panelTitle">Memory toast</div>
            <div class="toast">
              <div class="toastIcon">M</div>
              <div>
                <div class="toastTitle">Memory captured</div>
                <div class="toastText">"Rain calms the user. Keep pacing slow. Avoid intensity." Stored under <span class="mono">world:rain-city</span>.</div>
                <div style="display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                  <button class="btn">Open memory</button>
                  <button class="btn">Undo</button>
                </div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="panelTitle">System notes</div>
            <div style="display:grid; gap: 8px;">
              <div class="mono" style="color: var(--muted); font-size: 12px;">Focus ring: <span id="focusRing"></span></div>
              <div class="mono" style="color: var(--muted); font-size: 12px;">Accent: <span id="accentVal"></span></div>
              <div class="mono" style="color: var(--muted); font-size: 12px;">Surface: <span id="surfaceVal"></span></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="footer">Tip: This variation is less about aesthetics and more about the design system substrate (tokens + density). If Halley chooses a north-star look, this lets you preserve it while still offering modes.</div>
  </div>

  <script>
    const root = document.documentElement

    const themes = {
      calm: {
        '--bg': '#0b0f16',
        '--surface': 'rgba(17, 24, 38, 0.80)',
        '--surface2': 'rgba(15, 21, 34, 0.90)',
        '--text': '#eaf0ff',
        '--muted': 'rgba(234, 240, 255, 0.70)',
        '--border': 'rgba(255,255,255,0.12)',
        '--border2': 'rgba(255,255,255,0.18)',
        '--accent': '#7aa7ff',
        '--ok': '#6ee7b7',
        '--danger': '#ff5a7a'
      },
      paper: {
        '--bg': '#fbfaf8',
        '--surface': 'rgba(255, 255, 255, 0.78)',
        '--surface2': 'rgba(255, 255, 255, 0.92)',
        '--text': '#141414',
        '--muted': 'rgba(20, 20, 20, 0.66)',
        '--border': 'rgba(20, 20, 20, 0.12)',
        '--border2': 'rgba(20, 20, 20, 0.18)',
        '--accent': '#1b4dff',
        '--ok': '#0f9d58',
        '--danger': '#d7263d'
      },
      neon: {
        '--bg': '#06070a',
        '--surface': 'rgba(10, 12, 22, 0.82)',
        '--surface2': 'rgba(8, 10, 18, 0.92)',
        '--text': '#e9ffe8',
        '--muted': 'rgba(233, 255, 232, 0.62)',
        '--border': 'rgba(110, 231, 183, 0.16)',
        '--border2': 'rgba(122, 167, 255, 0.20)',
        '--accent': '#6ee7ff',
        '--ok': '#6ee7b7',
        '--danger': '#ff5ad1'
      }
    }

    const tokenKeys = [
      '--bg', '--surface', '--surface2', '--text', '--muted', '--border', '--border2', '--accent', '--ok', '--danger', '--space', '--radius'
    ]

    const tokenList = document.getElementById('tokenList')
    const density = document.getElementById('density')
    const densityVal = document.getElementById('densityVal')

    const focusRing = document.getElementById('focusRing')
    const accentVal = document.getElementById('accentVal')
    const surfaceVal = document.getElementById('surfaceVal')

    const readToken = (k) => getComputedStyle(root).getPropertyValue(k).trim()

    const renderTokens = () => {
      tokenList.innerHTML = ''
      for (const k of tokenKeys) {
        const val = readToken(k)
        const row = document.createElement('div')
        row.className = 'token'

        const key = document.createElement('div')
        key.className = 'tokenKey'
        key.textContent = k

        const value = document.createElement('div')
        value.className = 'tokenVal'
        value.textContent = val

        const swatch = document.createElement('div')
        swatch.className = 'swatch'
        const isColor = k !== '--space' && k !== '--radius'
        swatch.style.background = isColor ? val : 'linear-gradient(90deg, rgba(255,255,255,0.18), rgba(255,255,255,0.02))'

        row.appendChild(key)
        row.appendChild(value)
        row.appendChild(swatch)

        tokenList.appendChild(row)
      }

      focusRing.textContent = `0 0 0 4px ${colorMix(readToken('--accent'), 0.35)}`
      accentVal.textContent = readToken('--accent')
      surfaceVal.textContent = readToken('--surface')
    }

    const colorMix = (hexLike, a) => {
      const c = hexLike.trim()
      if (c.startsWith('#') && c.length === 7) {
        const r = parseInt(c.slice(1, 3), 16)
        const g = parseInt(c.slice(3, 5), 16)
        const b = parseInt(c.slice(5, 7), 16)
        return `rgba(${r}, ${g}, ${b}, ${a})`
      }
      return `rgba(122, 167, 255, ${a})`
    }

    const applyTheme = (name) => {
      const theme = themes[name]
      if (!theme) return
      for (const [k, v] of Object.entries(theme)) root.style.setProperty(k, v)
      renderTokens()
    }

    document.querySelectorAll('[data-theme]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-theme]').forEach(b => b.setAttribute('aria-pressed', 'false'))
        btn.setAttribute('aria-pressed', 'true')
        applyTheme(btn.getAttribute('data-theme'))
      })
    })

    density.addEventListener('input', () => {
      root.style.setProperty('--space', `${density.value}px`)
      densityVal.textContent = density.value
      renderTokens()
    })

    document.getElementById('export').addEventListener('click', async () => {
      const data = {}
      for (const k of tokenKeys) data[k] = readToken(k)
      const payload = JSON.stringify({ name: 'halley-sandbox-token-lab', tokens: data }, null, 2)
      try {
        await navigator.clipboard.writeText(payload)
        alert('Tokens copied to clipboard.')
      } catch {
        prompt('Copy tokens JSON:', payload)
      }
    })

    renderTokens()
  </script>
</body>
</html>
