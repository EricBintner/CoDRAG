<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Variation N — Command Surface</title>
  <style>
    :root {
      --bg: #0b0f16;
      --panel: rgba(17, 24, 38, 0.78);
      --panel2: rgba(15, 21, 34, 0.92);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,0.70);
      --border: rgba(255,255,255,0.12);
      --border2: rgba(255,255,255,0.18);
      --accent: #7aa7ff;
      --ok: #6ee7b7;
      --danger: #ff5a7a;
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at 20% 10%, rgba(122,167,255,0.14), transparent 40%), #0b0f16;
      color: var(--text);
    }

    a { color: inherit; text-decoration: none; }

    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 28px;
      display: grid;
      gap: 16px;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
    }

    .kicker {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
    }

    h1 { margin: 0; font-size: 28px; letter-spacing: -0.02em; }

    .sub {
      margin: 10px 0 0 0;
      max-width: 78ch;
      color: var(--muted);
      line-height: 1.5;
      font-size: 14px;
    }

    .btn {
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
    }

    .btn:hover { background: rgba(255,255,255,0.10); }
    .btn:active { transform: translateY(1px); }
    .btn:focus { outline: none; box-shadow: 0 0 0 4px rgba(122,167,255,0.22); }

    .bar {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .barInner {
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
    }

    .search {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.20);
    }

    .searchIcon {
      width: 28px;
      height: 28px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.06);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: var(--accent);
    }

    .search input {
      width: 100%;
      border: 0;
      background: transparent;
      color: var(--text);
      outline: none;
      font-size: 14px;
    }

    .hint {
      color: var(--muted);
      font-size: 12px;
      border: 1px solid var(--border2);
      border-bottom-color: rgba(255,255,255,0.28);
      border-radius: 10px;
      padding: 5px 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.3fr 0.7fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
    }

    .panel {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .panelHeader {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    .panelTitle { font-weight: 650; letter-spacing: -0.01em; }
    .panelSub { margin-top: 6px; color: var(--muted); font-size: 12px; line-height: 1.4; }

    .panelBody { padding: 14px 16px 16px 16px; display: grid; gap: 12px; }

    .row {
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.20);
      border-radius: 14px;
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      cursor: pointer;
      transition: background 120ms ease;
    }

    .row:hover { background: rgba(255,255,255,0.05); }

    .rowMain { display: grid; gap: 4px; }
    .rowTitle { font-weight: 600; }
    .rowDesc { color: var(--muted); font-size: 12px; line-height: 1.4; }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.05);
      font-size: 12px;
      color: var(--muted);
    }

    .dot { width: 8px; height: 8px; border-radius: 999px; background: var(--ok); }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .divider { height: 1px; background: rgba(255,255,255,0.08); margin: 4px 0; }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 80px 18px 18px 18px;
    }

    .overlay[aria-hidden="false"] { display: flex; }

    .palette {
      width: min(760px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(17,24,38,0.88);
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 80px rgba(0,0,0,0.55);
      overflow: hidden;
    }

    .paletteTop {
      padding: 14px 14px 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display: grid;
      gap: 10px;
    }

    .paletteInput {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: center;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
    }

    .paletteInput input {
      border: 0;
      background: transparent;
      color: var(--text);
      outline: none;
      font-size: 14px;
    }

    .paletteHint {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      color: rgba(234,240,255,0.66);
      font-size: 12px;
    }

    .paletteList { max-height: 360px; overflow: auto; }

    .cmd {
      padding: 12px 14px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
      border-top: 1px solid rgba(255,255,255,0.08);
      cursor: pointer;
    }

    .cmd:first-child { border-top: 0; }

    .cmd[aria-selected="true"] {
      background: rgba(122,167,255,0.18);
      border-top-color: rgba(122,167,255,0.22);
    }

    .cmdTitle { font-weight: 650; }
    .cmdDesc { color: rgba(234,240,255,0.70); font-size: 12px; margin-top: 4px; line-height: 1.4; }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.20);
      border-bottom-color: rgba(255,255,255,0.28);
      padding: 3px 7px;
      border-radius: 8px;
      color: rgba(234,240,255,0.72);
      white-space: nowrap;
    }

    .toast {
      display: none;
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: min(420px, calc(100% - 36px));
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(17, 24, 38, 0.92);
      box-shadow: 0 18px 70px rgba(0,0,0,0.55);
      padding: 12px;
    }

    .toast[aria-hidden="false"] { display: block; }

    .toastTitle { font-weight: 650; }
    .toastText { color: rgba(234,240,255,0.70); font-size: 12px; line-height: 1.4; margin-top: 4px; }
    .toastActions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }

    .mini {
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
    }

    .mini:hover { background: rgba(255,255,255,0.10); }

    .muted { color: var(--muted); }

    .sideList {
      display: grid;
      gap: 10px;
    }

    .sideItem {
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.20);
      display: grid;
      gap: 6px;
    }

    .sideItemTitle { font-weight: 650; }
    .sideItemText { color: var(--muted); font-size: 12px; line-height: 1.4; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="kicker"><span class="badge">Variation N</span><span class="mono">Command surface</span></div>
        <h1>Keyboard-first UI Layer</h1>
        <p class="sub">A sandbox for a command palette as a design-system primitive: consistent actions, consistent vocabulary, consistent shortcuts. This can unify Halley navigation across chat, personas, worlds, and admin/audit surfaces.</p>
      </div>
      <div style="display:flex; gap: 10px; align-items: center;">
        <a class="btn" href="../index.html">Back</a>
        <button class="btn" id="openPalette">Open palette</button>
      </div>
    </div>

    <div class="bar">
      <div class="barInner">
        <div class="search" role="search">
          <div class="searchIcon">K</div>
          <input id="globalSearch" placeholder="Search worlds, personas, memories" />
          <div class="hint">Ctrl/⌘ K</div>
        </div>
        <div style="display:flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: flex-end;">
          <span class="chip"><span class="dot" style="background: var(--accent);"></span>Mode: SFW</span>
          <span class="chip"><span class="dot"></span>Memory: capture</span>
          <span class="chip"><span class="dot" style="background: var(--danger);"></span>World: rain-city</span>
        </div>
      </div>
    </div>

    <div class="layout">
      <section class="panel" aria-label="Primary actions">
        <div class="panelHeader">
          <div>
            <div class="panelTitle">Surface actions</div>
            <div class="panelSub">These are the kinds of actions that benefit from a single command surface (same naming, same shortcuts, same permission checks).</div>
          </div>
          <div class="chip"><span class="dot" style="background: var(--accent);"></span><span class="mono">/cmd</span> vocabulary</div>
        </div>
        <div class="panelBody">
          <div class="row" data-cmd="New World">
            <div class="rowMain">
              <div class="rowTitle">New World</div>
              <div class="rowDesc">Create a world scaffold with memory policy + tone baseline.</div>
            </div>
            <div class="mono muted">W</div>
          </div>

          <div class="row" data-cmd="Switch Persona">
            <div class="rowMain">
              <div class="rowTitle">Switch Persona</div>
              <div class="rowDesc">Jump between personas without leaving the current context.</div>
            </div>
            <div class="mono muted">P</div>
          </div>

          <div class="row" data-cmd="Search Chat">
            <div class="rowMain">
              <div class="rowTitle">Search Chat</div>
              <div class="rowDesc">Find a moment by keyword, date, or memory tag.</div>
            </div>
            <div class="mono muted">F</div>
          </div>

          <div class="row" data-cmd="Open Memory Audit">
            <div class="rowMain">
              <div class="rowTitle">Open Memory Audit</div>
              <div class="rowDesc">Review what was captured and why; tune capture thresholds.</div>
            </div>
            <div class="mono muted">A</div>
          </div>

          <div class="row" data-cmd="Toggle SFW">
            <div class="rowMain">
              <div class="rowTitle">Toggle SFW</div>
              <div class="rowDesc">Switch behavior posture; reflect it in UI copy and defaults.</div>
            </div>
            <div class="mono muted">S</div>
          </div>

          <div class="divider"></div>

          <div class="row" data-cmd="Open Settings">
            <div class="rowMain">
              <div class="rowTitle">Open Settings</div>
              <div class="rowDesc">System-level preferences, privacy, and performance controls.</div>
            </div>
            <div class="mono muted">,</div>
          </div>

          <div class="row" data-cmd="Export Conversation">
            <div class="rowMain">
              <div class="rowTitle">Export Conversation</div>
              <div class="rowDesc">Share a sanitized excerpt with citations + timestamps.</div>
            </div>
            <div class="mono muted">E</div>
          </div>
        </div>
      </section>

      <aside class="panel" aria-label="Guidance">
        <div class="panelHeader">
          <div>
            <div class="panelTitle">Design-system notes</div>
            <div class="panelSub">The palette is not a feature; it's a system pattern. Same structure across surfaces makes Halley feel coherent.</div>
          </div>
        </div>
        <div class="panelBody">
          <div class="sideList">
            <div class="sideItem">
              <div class="sideItemTitle">Consistent verbs</div>
              <div class="sideItemText">Use the same action naming everywhere: <span class="mono">Open</span>, <span class="mono">Switch</span>, <span class="mono">New</span>, <span class="mono">Export</span>, <span class="mono">Audit</span>.</div>
            </div>
            <div class="sideItem">
              <div class="sideItemTitle">Permission-aware</div>
              <div class="sideItemText">Show only commands the user can perform. Explain why something is disabled (not just "no").</div>
            </div>
            <div class="sideItem">
              <div class="sideItemTitle">Low cognitive load</div>
              <div class="sideItemText">Users should not memorize shortcuts. The palette teaches them.</div>
            </div>
            <div class="sideItem">
              <div class="sideItemTitle">Keyboard + mouse parity</div>
              <div class="sideItemText">All commands remain discoverable via UI buttons. Palette is an accelerator, not a gate.</div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="palette" role="dialog" aria-modal="true" aria-label="Command palette">
      <div class="paletteTop">
        <div class="paletteInput">
          <div class="searchIcon" style="width: 30px; height: 30px;">⌘</div>
          <input id="paletteQuery" placeholder="Type a command…" autocomplete="off" />
        </div>
        <div class="paletteHint">
          <div>Navigate with <span class="kbd">↑</span> <span class="kbd">↓</span>, run with <span class="kbd">Enter</span>, close with <span class="kbd">Esc</span></div>
          <div class="mono muted">Halley /cmd</div>
        </div>
      </div>
      <div class="paletteList" id="paletteList"></div>
    </div>
  </div>

  <div class="toast" id="toast" aria-hidden="true">
    <div class="toastTitle" id="toastTitle">Action</div>
    <div class="toastText" id="toastText">Done.</div>
    <div class="toastActions">
      <button class="mini" id="toastClose">Close</button>
      <button class="mini" id="toastRepeat">Repeat</button>
    </div>
  </div>

  <script>
    const commands = [
      { title: 'New World', desc: 'Create a world scaffold with tone + memory policy.', keys: ['⌘N', 'Ctrl N'], intent: 'create' },
      { title: 'Switch Persona', desc: 'Jump between personas while keeping context.', keys: ['⌘P', 'Ctrl P'], intent: 'navigate' },
      { title: 'Search Chat', desc: 'Find a moment by keyword, date, or tag.', keys: ['⌘F', 'Ctrl F'], intent: 'search' },
      { title: 'Open Memory Audit', desc: 'Review what was captured and why; tune capture thresholds.', keys: ['⌘A', 'Ctrl A'], intent: 'audit' },
      { title: 'Toggle SFW', desc: 'Switch behavior posture and defaults.', keys: ['⌘⇧S', 'Ctrl Shift S'], intent: 'mode' },
      { title: 'Open Settings', desc: 'System preferences, privacy, performance.', keys: ['⌘,', 'Ctrl ,'], intent: 'settings' },
      { title: 'Export Conversation', desc: 'Share a sanitized excerpt with timestamps.', keys: ['⌘E', 'Ctrl E'], intent: 'export' }
    ]

    const overlay = document.getElementById('overlay')
    const openPalette = document.getElementById('openPalette')
    const globalSearch = document.getElementById('globalSearch')
    const paletteQuery = document.getElementById('paletteQuery')
    const paletteList = document.getElementById('paletteList')

    const toast = document.getElementById('toast')
    const toastTitle = document.getElementById('toastTitle')
    const toastText = document.getElementById('toastText')
    const toastClose = document.getElementById('toastClose')
    const toastRepeat = document.getElementById('toastRepeat')

    let visible = [...commands]
    let active = 0
    let lastAction = null

    const open = () => {
      overlay.setAttribute('aria-hidden', 'false')
      paletteQuery.value = ''
      visible = [...commands]
      active = 0
      render()
      setTimeout(() => paletteQuery.focus(), 0)
    }

    const close = () => {
      overlay.setAttribute('aria-hidden', 'true')
      globalSearch.focus()
    }

    const setToast = (title) => {
      toastTitle.textContent = title
      toastText.textContent = `Executed: ${title}. (In-app this would navigate or open a modal.)`
      toast.setAttribute('aria-hidden', 'false')
      lastAction = title
    }

    const hideToast = () => toast.setAttribute('aria-hidden', 'true')

    const render = () => {
      paletteList.innerHTML = ''
      visible.forEach((c, i) => {
        const el = document.createElement('div')
        el.className = 'cmd'
        el.setAttribute('role', 'option')
        el.setAttribute('aria-selected', i === active ? 'true' : 'false')

        const left = document.createElement('div')
        const t = document.createElement('div')
        t.className = 'cmdTitle'
        t.textContent = c.title
        const d = document.createElement('div')
        d.className = 'cmdDesc'
        d.textContent = c.desc
        left.appendChild(t)
        left.appendChild(d)

        const right = document.createElement('div')
        right.style.display = 'flex'
        right.style.gap = '8px'
        for (const k of c.keys) {
          const span = document.createElement('span')
          span.className = 'kbd'
          span.textContent = k
          right.appendChild(span)
        }

        el.appendChild(left)
        el.appendChild(right)

        el.addEventListener('mousemove', () => {
          active = i
          syncSelection()
        })
        el.addEventListener('click', () => {
          run(i)
        })

        paletteList.appendChild(el)
      })
    }

    const syncSelection = () => {
      Array.from(paletteList.children).forEach((c, i) => c.setAttribute('aria-selected', i === active ? 'true' : 'false'))
    }

    const filter = (q) => {
      const query = (q || '').trim().toLowerCase()
      if (!query) return [...commands]
      return commands.filter(c => `${c.title} ${c.desc} ${c.keys.join(' ')}`.toLowerCase().includes(query))
    }

    const run = (idx) => {
      const cmd = visible[idx]
      if (!cmd) return
      lastAction = cmd.title
      setToast(cmd.title)
      close()
    }

    openPalette.addEventListener('click', open)

    document.querySelectorAll('[data-cmd]').forEach(el => {
      el.addEventListener('click', () => setToast(el.getAttribute('data-cmd')))
    })

    toastClose.addEventListener('click', hideToast)
    toastRepeat.addEventListener('click', () => {
      if (!lastAction) return
      setToast(lastAction)
    })

    overlay.addEventListener('mousedown', (e) => {
      if (e.target === overlay) close()
    })

    paletteQuery.addEventListener('input', () => {
      visible = filter(paletteQuery.value)
      active = 0
      render()
    })

    document.addEventListener('keydown', (e) => {
      const isK = (e.key || '').toLowerCase() === 'k'
      const meta = e.metaKey || e.ctrlKey
      if (meta && isK) {
        e.preventDefault()
        open()
        return
      }

      const openNow = overlay.getAttribute('aria-hidden') === 'false'
      if (!openNow) return

      if (e.key === 'Escape') {
        e.preventDefault()
        close()
        return
      }

      if (e.key === 'ArrowDown') {
        e.preventDefault()
        active = Math.min(active + 1, Math.max(0, visible.length - 1))
        syncSelection()
        return
      }

      if (e.key === 'ArrowUp') {
        e.preventDefault()
        active = Math.max(active - 1, 0)
        syncSelection()
        return
      }

      if (e.key === 'Enter') {
        e.preventDefault()
        run(active)
      }
    })

    globalSearch.addEventListener('focus', () => hideToast())
  </script>
</body>
</html>
