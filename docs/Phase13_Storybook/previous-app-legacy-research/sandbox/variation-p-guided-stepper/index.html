<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Variation P — Guided Stepper</title>
  <style>
    :root {
      --bg: #fbfaf8;
      --surface: rgba(255, 255, 255, 0.86);
      --surface2: rgba(255, 255, 255, 0.96);
      --text: #141414;
      --muted: rgba(20, 20, 20, 0.62);
      --border: rgba(20, 20, 20, 0.12);
      --border2: rgba(20, 20, 20, 0.18);
      --accent: #1b4dff;
      --ok: #0f9d58;
      --danger: #d7263d;
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at 24% 14%, rgba(27, 77, 255, 0.10), transparent 46%), var(--bg);
      color: var(--text);
    }

    a { color: inherit; text-decoration: none; }

    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 28px;
      display: grid;
      gap: 16px;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
    }

    .kicker {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(20,20,20,0.03);
    }

    h1 { margin: 0; font-size: 28px; letter-spacing: -0.02em; }

    .sub {
      margin: 10px 0 0 0;
      max-width: 80ch;
      color: var(--muted);
      line-height: 1.5;
      font-size: 14px;
    }

    .btn {
      border: 1px solid var(--border2);
      background: rgba(20,20,20,0.03);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
    }

    .btn:hover { background: rgba(20,20,20,0.06); }
    .btn:active { transform: translateY(1px); }
    .btn:focus { outline: none; box-shadow: 0 0 0 4px rgba(27,77,255,0.16); }

    .btnPrimary {
      border-color: rgba(27,77,255,0.28);
      background: rgba(27,77,255,0.08);
    }

    .btnDanger {
      border-color: rgba(215,38,61,0.22);
      background: rgba(215,38,61,0.06);
    }

    .layout {
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      border: 1px solid var(--border);
      background: var(--surface);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 18px 70px rgba(0,0,0,0.10);
    }

    .cardHeader {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.55);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .title { font-weight: 650; letter-spacing: -0.01em; }
    .hint { margin-top: 6px; color: var(--muted); font-size: 12px; line-height: 1.4; }

    .steps {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }

    .stepDot {
      width: 30px;
      height: 30px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(20,20,20,0.03);
      display: grid;
      place-items: center;
      font-size: 12px;
      color: rgba(20,20,20,0.72);
      user-select: none;
    }

    .stepDot[aria-current="true"] {
      border-color: rgba(27,77,255,0.35);
      background: rgba(27,77,255,0.10);
      color: rgba(20,20,20,0.92);
      box-shadow: 0 0 0 4px rgba(27,77,255,0.12);
    }

    .stepDot[aria-checked="true"] {
      border-color: rgba(15,157,88,0.28);
      background: rgba(15,157,88,0.08);
      color: rgba(15,157,88,0.95);
    }

    .cardBody {
      padding: 16px;
      display: grid;
      gap: 12px;
    }

    .field { display: grid; gap: 8px; }

    label {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    input[type="text"], textarea, select {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.55);
      color: var(--text);
      outline: none;
      font-size: 14px;
    }

    input[type="text"]:focus, textarea:focus, select:focus {
      border-color: rgba(27,77,255,0.32);
      box-shadow: 0 0 0 4px rgba(27,77,255,0.14);
    }

    .help {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    .radioGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    @media (max-width: 560px) {
      .radioGrid { grid-template-columns: 1fr; }
    }

    .choice {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.65);
      border-radius: 14px;
      padding: 12px;
      display: grid;
      gap: 6px;
      cursor: pointer;
      user-select: none;
      transition: background 120ms ease;
    }

    .choice:hover { background: rgba(255,255,255,0.86); }

    .choiceTitle { font-weight: 650; }
    .choiceText { color: var(--muted); font-size: 12px; line-height: 1.4; }

    .choice[aria-checked="true"] {
      border-color: rgba(27,77,255,0.30);
      box-shadow: 0 0 0 4px rgba(27,77,255,0.12);
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .leftActions { display: flex; gap: 10px; flex-wrap: wrap; }

    .status {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.55);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    .preview {
      display: grid;
      gap: 12px;
      padding: 16px;
    }

    .panel {
      border: 1px solid var(--border);
      background: var(--surface2);
      border-radius: var(--radius);
      padding: 14px;
      display: grid;
      gap: 10px;
    }

    .panelTitle { font-weight: 650; }

    .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(20,20,20,0.03);
      font-size: 12px;
      color: rgba(20,20,20,0.72);
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--ok);
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .list {
      display: grid;
      gap: 10px;
    }

    .listItem {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,0.65);
      display: grid;
      gap: 6px;
    }

    .listItemTitle { font-weight: 650; }
    .listItemText { color: var(--muted); font-size: 12px; line-height: 1.4; }

    .warn {
      border-color: rgba(215, 38, 61, 0.22);
      background: rgba(215, 38, 61, 0.04);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="kicker"><span class="badge">Variation P</span><span class="mono">guided stepper</span></div>
        <h1>Guided Setup as a System Pattern</h1>
        <p class="sub">This variation explores onboarding and complex configuration as a reusable design-system component: a stepper with progressive disclosure, strong copy, visible progress, and a live “result preview” pane. In Halley this maps to persona creation, world setup, and safety/memory policy configuration.</p>
      </div>
      <div style="display:flex; gap: 10px; align-items:center;">
        <a class="btn" href="../index.html">Back</a>
        <button class="btn" id="reset">Reset</button>
      </div>
    </div>

    <div class="layout">
      <section class="card" aria-label="Stepper">
        <div class="cardHeader">
          <div>
            <div class="title" id="stepTitle">Step 1 — Posture</div>
            <div class="hint" id="stepHint">Set defaults first. Use a calm, explicit posture so the system behaves consistently.</div>
          </div>
          <div class="steps" aria-label="Progress">
            <div class="stepDot" data-stepdot="0" aria-current="true" aria-checked="false">1</div>
            <div class="stepDot" data-stepdot="1" aria-current="false" aria-checked="false">2</div>
            <div class="stepDot" data-stepdot="2" aria-current="false" aria-checked="false">3</div>
            <div class="stepDot" data-stepdot="3" aria-current="false" aria-checked="false">4</div>
          </div>
        </div>

        <div class="cardBody">
          <div id="step0" class="step" aria-hidden="false">
            <div class="field">
              <label>Mode</label>
              <div class="radioGrid" role="radiogroup" aria-label="Mode">
                <div class="choice" data-choice="mode" data-value="SFW" aria-checked="true" role="radio" tabindex="0">
                  <div class="choiceTitle">SFW</div>
                  <div class="choiceText">Honest, high-quality, non-fixated behavior posture. Default-safe copy and actions.</div>
                </div>
                <div class="choice" data-choice="mode" data-value="NSFW" aria-checked="false" role="radio" tabindex="0">
                  <div class="choiceTitle">NSFW</div>
                  <div class="choiceText">Explicit mode with clear boundaries and visible safety framing (still respectful and controlled).</div>
                </div>
              </div>
              <div class="help">Design-system point: mode selection should be visible, sticky, and reflected in defaults (copy, toggle labels, disclaimers).</div>
            </div>

            <div class="field">
              <label for="tone">Tone baseline</label>
              <select id="tone">
                <option value="Calm">Calm</option>
                <option value="Neutral">Neutral</option>
                <option value="Playful">Playful</option>
                <option value="Cinematic">Cinematic</option>
              </select>
              <div class="help">Pick a tone baseline for the world. Halley should reveal the active tone in the UI (small badge, not hidden).</div>
            </div>
          </div>

          <div id="step1" class="step" aria-hidden="true" style="display:none;">
            <div class="field">
              <label for="persona">Persona</label>
              <input id="persona" type="text" value="CLaRa" />
              <div class="help">Give the persona a simple canonical name. (System rule: avoid display-name drift across surfaces.)</div>
            </div>

            <div class="field">
              <label for="personaStyle">Persona style</label>
              <select id="personaStyle">
                <option value="Reflective">Reflective</option>
                <option value="Direct">Direct</option>
                <option value="Warm">Warm</option>
                <option value="Clinical">Clinical</option>
              </select>
              <div class="help">Design-system point: style should map to a small set of composable traits, not free-form chaos.</div>
            </div>

            <div class="field">
              <label for="world">World</label>
              <input id="world" type="text" value="Rain City" />
              <div class="help">World naming should remain stable: reuse in navigation, memory tags, audit views.</div>
            </div>
          </div>

          <div id="step2" class="step" aria-hidden="true" style="display:none;">
            <div class="field">
              <label>Memory capture posture</label>
              <div class="radioGrid" role="radiogroup" aria-label="Memory posture">
                <div class="choice" data-choice="memory" data-value="Confirm" aria-checked="true" role="radio" tabindex="0">
                  <div class="choiceTitle">Confirm before saving</div>
                  <div class="choiceText">User explicitly approves. Reduces surprises and increases trust.</div>
                </div>
                <div class="choice" data-choice="memory" data-value="Auto" aria-checked="false" role="radio" tabindex="0">
                  <div class="choiceTitle">Auto-capture signals</div>
                  <div class="choiceText">Capture only when rules trigger; always show “why captured”.</div>
                </div>
              </div>
              <div class="help">Design-system point: “why did this happen” UI is a reusable component (toast + link to audit rationale).</div>
            </div>

            <div class="field">
              <label for="note">Rule note (optional)</label>
              <textarea id="note" rows="3" placeholder="e.g. Keep pacing slow. Avoid intensity. Preserve calm." ></textarea>
              <div class="help">Optional annotation shown in audit surfaces and world headers; avoid burying policy in docs.</div>
            </div>
          </div>

          <div id="step3" class="step" aria-hidden="true" style="display:none;">
            <div class="panel warn">
              <div class="panelTitle">Review</div>
              <div class="help" style="color: rgba(20,20,20,0.74);">The last step is deliberate: confirm what the system will do. This reduces regret and creates user trust.</div>
            </div>

            <div class="list" id="reviewList"></div>

            <div class="field">
              <label for="confirm">Type CONFIRM to apply</label>
              <input id="confirm" type="text" placeholder="CONFIRM" />
              <div class="help">Design-system point: for high-stakes actions, use friction intentionally (not everywhere).</div>
            </div>
          </div>

          <div class="actions">
            <div class="leftActions">
              <button class="btn" id="back" disabled>Back</button>
              <button class="btn btnPrimary" id="next">Next</button>
            </div>
            <div class="status" id="status">Progressive disclosure: only show what matters for this step.</div>
          </div>
        </div>
      </section>

      <aside class="card" aria-label="Preview pane">
        <div class="cardHeader">
          <div>
            <div class="title">Live preview</div>
            <div class="hint">Shows the resulting configuration as the user moves through the flow.</div>
          </div>
          <div style="display:flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;">
            <span class="pill"><span class="dot" style="background: var(--accent);"></span><span id="pillMode">SFW</span></span>
            <span class="pill"><span class="dot"></span><span id="pillMemory">Confirm</span></span>
          </div>
        </div>

        <div class="preview">
          <div class="panel">
            <div class="panelTitle">Context header</div>
            <div style="display:flex; gap: 10px; flex-wrap: wrap; align-items:center;">
              <span class="pill"><span class="dot" style="background: var(--accent);"></span>World: <span id="pvWorld">Rain City</span></span>
              <span class="pill"><span class="dot"></span>Persona: <span id="pvPersona">CLaRa</span></span>
              <span class="pill"><span class="dot" style="background: var(--ok);"></span>Tone: <span id="pvTone">Calm</span></span>
            </div>
          </div>

          <div class="panel">
            <div class="panelTitle">Example system copy</div>
            <div class="list">
              <div class="listItem">
                <div class="listItemTitle">Memory capture</div>
                <div class="listItemText" id="pvCopy1">I can save this as a memory. Want me to?</div>
              </div>
              <div class="listItem">
                <div class="listItemTitle">Mode disclosure</div>
                <div class="listItemText" id="pvCopy2">Mode: SFW (honest, non-fixated). You can change this any time.</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="panelTitle">Notes</div>
            <div class="help" id="pvNote">No rule note yet.</div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const steps = [
      {
        title: 'Step 1 — Posture',
        hint: 'Set defaults first. Use a calm, explicit posture so the system behaves consistently.'
      },
      {
        title: 'Step 2 — Identity',
        hint: 'Choose persona + world naming. Keep identifiers stable across the product.'
      },
      {
        title: 'Step 3 — Memory policy',
        hint: 'Decide how persistence works. Make the policy visible and auditable.'
      },
      {
        title: 'Step 4 — Confirm',
        hint: 'Confirm outcomes and apply. Use intentional friction only on high-stakes actions.'
      }
    ]

    const state = {
      mode: 'SFW',
      tone: 'Calm',
      persona: 'CLaRa',
      personaStyle: 'Reflective',
      world: 'Rain City',
      memory: 'Confirm',
      note: '',
      confirm: ''
    }

    const stepTitle = document.getElementById('stepTitle')
    const stepHint = document.getElementById('stepHint')
    const status = document.getElementById('status')

    const back = document.getElementById('back')
    const next = document.getElementById('next')
    const reset = document.getElementById('reset')

    const pillMode = document.getElementById('pillMode')
    const pillMemory = document.getElementById('pillMemory')

    const pvWorld = document.getElementById('pvWorld')
    const pvPersona = document.getElementById('pvPersona')
    const pvTone = document.getElementById('pvTone')
    const pvCopy1 = document.getElementById('pvCopy1')
    const pvCopy2 = document.getElementById('pvCopy2')
    const pvNote = document.getElementById('pvNote')

    const tone = document.getElementById('tone')
    const persona = document.getElementById('persona')
    const personaStyle = document.getElementById('personaStyle')
    const world = document.getElementById('world')
    const note = document.getElementById('note')
    const confirm = document.getElementById('confirm')
    const reviewList = document.getElementById('reviewList')

    let idx = 0

    const setChoice = (group, value) => {
      document.querySelectorAll(`[data-choice="${group}"]`).forEach(el => {
        el.setAttribute('aria-checked', el.getAttribute('data-value') === value ? 'true' : 'false')
      })
      state[group] = value
      renderPreview()
    }

    const wireChoices = () => {
      document.querySelectorAll('[data-choice]').forEach(el => {
        const group = el.getAttribute('data-choice')
        const value = el.getAttribute('data-value')

        const activate = () => setChoice(group, value)

        el.addEventListener('click', activate)
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault()
            activate()
          }
        })
      })
    }

    const showStep = (n) => {
      idx = Math.max(0, Math.min(n, steps.length - 1))

      for (let i = 0; i < steps.length; i++) {
        const node = document.getElementById(`step${i}`)
        const isOn = i === idx
        node.style.display = isOn ? '' : 'none'
        node.setAttribute('aria-hidden', isOn ? 'false' : 'true')
      }

      stepTitle.textContent = steps[idx].title
      stepHint.textContent = steps[idx].hint

      back.disabled = idx === 0
      next.textContent = idx === steps.length - 1 ? 'Apply' : 'Next'

      document.querySelectorAll('[data-stepdot]').forEach(dot => {
        const n2 = Number(dot.getAttribute('data-stepdot'))
        dot.setAttribute('aria-current', n2 === idx ? 'true' : 'false')
        dot.setAttribute('aria-checked', n2 < idx ? 'true' : 'false')
      })

      if (idx === 3) renderReview()
      renderPreview()
    }

    const renderReview = () => {
      reviewList.innerHTML = ''
      const items = [
        { t: 'Mode', v: state.mode },
        { t: 'Tone', v: state.tone },
        { t: 'Persona', v: `${state.persona} (${state.personaStyle})` },
        { t: 'World', v: state.world },
        { t: 'Memory capture', v: state.memory },
        { t: 'Rule note', v: state.note ? state.note : '—' }
      ]

      for (const it of items) {
        const el = document.createElement('div')
        el.className = 'listItem'
        el.innerHTML = `<div class="listItemTitle">${escapeHtml(it.t)}</div><div class="listItemText">${escapeHtml(it.v)}</div>`
        reviewList.appendChild(el)
      }
    }

    const renderPreview = () => {
      pillMode.textContent = state.mode
      pillMemory.textContent = state.memory

      pvWorld.textContent = state.world || '—'
      pvPersona.textContent = state.persona || '—'
      pvTone.textContent = state.tone

      pvCopy1.textContent = state.memory === 'Confirm'
        ? 'I can save this as a memory. Want me to?'
        : 'Saved as a memory (reason: rule trigger). View why captured.'

      pvCopy2.textContent = state.mode === 'SFW'
        ? 'Mode: SFW (honest, non-fixated). You can change this any time.'
        : 'Mode: NSFW (explicit). You can change this any time.'

      pvNote.textContent = state.note ? state.note : 'No rule note yet.'

      if (idx === 3) {
        status.textContent = 'High-stakes apply: require explicit confirmation.'
      } else {
        status.textContent = 'Progressive disclosure: only show what matters for this step.'
      }
    }

    const escapeHtml = (s) => (s || '').toString().replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;')

    tone.addEventListener('change', () => {
      state.tone = tone.value
      renderPreview()
    })

    persona.addEventListener('input', () => {
      state.persona = persona.value
      renderPreview()
    })

    personaStyle.addEventListener('change', () => {
      state.personaStyle = personaStyle.value
      renderPreview()
    })

    world.addEventListener('input', () => {
      state.world = world.value
      renderPreview()
    })

    note.addEventListener('input', () => {
      state.note = note.value
      renderPreview()
    })

    confirm.addEventListener('input', () => {
      state.confirm = confirm.value
    })

    back.addEventListener('click', () => showStep(idx - 1))

    next.addEventListener('click', () => {
      if (idx < steps.length - 1) {
        showStep(idx + 1)
        return
      }

      if ((state.confirm || '').trim().toUpperCase() !== 'CONFIRM') {
        alert('Type CONFIRM to apply.')
        return
      }

      alert('Applied. (Sandbox only)')
    })

    reset.addEventListener('click', () => {
      state.mode = 'SFW'
      state.tone = 'Calm'
      state.persona = 'CLaRa'
      state.personaStyle = 'Reflective'
      state.world = 'Rain City'
      state.memory = 'Confirm'
      state.note = ''
      state.confirm = ''

      tone.value = 'Calm'
      persona.value = 'CLaRa'
      personaStyle.value = 'Reflective'
      world.value = 'Rain City'
      note.value = ''
      confirm.value = ''

      setChoice('mode', 'SFW')
      setChoice('memory', 'Confirm')
      showStep(0)
    })

    wireChoices()
    renderPreview()
    showStep(0)
  </script>
</body>
</html>
